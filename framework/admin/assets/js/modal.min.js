if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}(function(b){var a={init:function(e,f){var c=this;c.elem=f;c.$elem=b(f);c.secondary=false;c.options=b.extend({},b.fn.ThemeBlvdModal.options,e);for(var d in c.options){if(c.$elem.data(d)){c.options[d]=c.$elem.data(d)}}c.target=c.$elem.data("target");c.$target=b("#"+c.target);c.$elem.off("click.themeblvd-modal");c.$elem.on("click.themeblvd-modal",function(){c.popup="";if(b("body").hasClass("themeblvd-modal-on")){c.secondary=true}c.id=c.target;if(c.options.build){c.id+="_build";c.build()}c.$modal_window=b("#"+c.id);c.$modal_window.data("target",c.target);if(c.options.padding){c.$modal_window.find(".media-frame-content-inner").css("padding","20px")}c.options.on_load.call(c);c.$modal_window.find(".media-modal-close").off("click.themeblvd-modal-close");c.$modal_window.find(".media-modal-close").on("click.themeblvd-modal-close",function(){c.options.on_cancel.call(c);c.close();return false});c.$modal_window.find(".media-button-insert").off("click.themeblvd-modal-insert");c.$modal_window.find(".media-button-insert").on("click.themeblvd-modal-insert",function(){c.options.on_save.call(c);c.save();c.close();return false});if(c.options.button_secondary){c.$modal_window.find(".media-button-secondary").off("click.themeblvd-modal-secondary");c.$modal_window.find(".media-button-secondary").on("click.themeblvd-modal-secondary",function(){c.options.on_secondary.call(c);c.close();return false})}if(c.options.button_delete){var g=c.$elem.parent().is(".block-nav")?themeblvd.delete_block:themeblvd.delete_item;c.$modal_window.find(".media-button-delete").off("click.themeblvd-modal-delete");c.$modal_window.find(".media-button-delete").on("click.themeblvd-modal-delete",function(){tbc_confirm(g,{confirm:true},function(h){if(h){c.options.on_delete.call(c);c.close()}});return false})}c.display();c.options.on_display.call(c);return false})},build:function(){var d=this,g,c='<div id="%id%" class="themeblvd-modal-wrap build" style="display:none;">                                 <div class="themeblvd-modal %size%-modal %height%-height-modal media-modal wp-core-ui hide">                                     <a class="media-modal-close" href="#" title="Close">                                         <span class="media-modal-icon"></span>                                     </a>                                     <div class="media-modal-content">                                         <div class="media-frame wp-core-ui hide-menu hide-router">                                             <div class="media-frame-title">                                                 <h1>%title%</h1>                                             </div><!-- .media-frame-title (end) -->                                             <div class="media-frame-content">                                                 <div class="media-frame-content-inner">                                                     <div class="content-mitt">                                                         %content%                                                     </div>                                                 </div><!-- .media-frame-content-inner (end) -->                                             </div><!-- .media-frame-content (end) -->                                             <div class="media-frame-toolbar">                                                 <div class="media-toolbar">                                                     <div class="media-toolbar-primary">                                                         <a href="#" class="button media-button button-primary button-large media-button-insert">%button_text%</a>                                                     </div>                                                 </div><!-- .media-toolbar (end) -->                                             </div><!-- .media-frame-toolbar (end) -->                                         </div><!-- .media-frame (end) -->                                     </div><!-- .media-modal-content (end) -->                                  </div><!-- .themeblvd-modal (end) -->                              </div>';d.popup=c;d.popup=d.popup.replace("%id%",d.id);d.popup=d.popup.replace("%size%",d.options.size);d.popup=d.popup.replace("%height%",d.options.height);d.popup=d.popup.replace("%title%",d.options.title);d.popup=d.popup.replace("%button_text%",d.options.button);if(d.options.code_editor){d.popup=d.popup.replace("%content%",'<form><textarea id="'+d.id+'_editor" name="code"></textarea></form>')}if(d.options.form){d.popup=d.popup.replace("%content%",'<div id="optionsframework"></div>')}b("body").append(d.popup);var e=b("#"+d.id);if(d.options.button_secondary){e.find(".media-toolbar").prepend('<div class="media-toolbar-secondary"><a href="#" class="button media-button button-secondary button-large media-button-secondary">'+d.options.button_secondary+"</a></div>")}if(d.options.button_delete){e.find(".media-toolbar").prepend('<div class="media-toolbar-secondary"><a href="#" class="button media-button button-secondary button-large media-button-delete">'+d.options.button_delete+"</a></div>")}if(d.options.code_editor){if(d.$elem.is(".tb-block-code-link")){var f=d.$elem.closest(".block").data("field-name");g=d.$elem.closest(".block").find('textarea[name="'+f+'[html]"]').val()}else{g=d.$elem.closest(".textarea-wrap").find("textarea").val()}b("#"+d.id+"_editor").val(g)}else{d.$target.after('<div id="'+d.id+'_marker"></div>');if(d.options.form){e.find("#optionsframework").append(d.$target)}else{e.find(".content-mitt").append(d.$target)}}},display:function(){var d=this,f=b("body"),c;if(d.secondary){f.addClass("themeblvd-secondary-modal-on");d.$modal_window.find(".themeblvd-modal").removeClass("themeblvd-first-modal").addClass("themeblvd-second-modal");f.find(".themeblvd-first-modal").prepend('<div class="inline-media-modal-backdrop"></div>')}else{f.addClass("themeblvd-modal-on");f.addClass("themeblvd-stop-scroll");f.append('<div id="themeblvd-modal-backdrop" class="media-modal-backdrop"></div>');d.$modal_window.find(".themeblvd-modal").addClass("themeblvd-first-modal");b("#themeblvd-modal-backdrop").off("click.themeblvd-modal-backdrop");b("#themeblvd-modal-backdrop").on("click.themeblvd-modal-backdrop",function(){d.options.on_cancel.call(d);d.close_all();return false})}if(d.options.css_class){d.$modal_window.find(".themeblvd-modal").addClass(d.options.css_class)}d.$modal_window.show();if(d.options.code_editor&&typeof CodeMirror!=="undefined"){var e,h;e=b("#"+d.id+"_editor").data("CodeMirrorInstance");if(!e){if(d.options.code_lang=="css"||d.options.code_lang=="javascript"){h=d.options.code_lang}else{h={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]}}var e=CodeMirror.fromTextArea(document.getElementById(d.id+"_editor"),{mode:h,lineNumbers:true,theme:"themeblvd",indentUnit:4,tabSize:4,indentWithTabs:true,autofocus:true});if(e){b("#"+d.id+"_editor").data("CodeMirrorInstance",e)}}}if(d.options.height=="auto"){var g=b(window).height();c=d.$modal_window.find(".media-frame-content-inner").outerHeight();c=57+c+60;if(d.options.code_editor){c+=2}else{c+=10}d.$modal_window.find(".themeblvd-modal").css({"max-height":c+"px",top:(g-c)/2+"px"});b(window).resize(function(){d.$modal_window.find(".themeblvd-modal").css("top",(b(window).height()-c)/2+"px")})}if(d.options.form){d.$modal_window.themeblvd("options","setup");d.$modal_window.themeblvd("options","bind");d.$modal_window.themeblvd("options","media-uploader");d.$modal_window.themeblvd("options","sortable")}},close:function(){var c=this,d=b("body");if(c.options.build){b("#"+c.id+"_marker").after(c.$target).remove()}c.$modal_window.find(".media-button-secondary").off("click.themeblvd-modal-secondary");c.$modal_window.find(".media-modal-close").off("click.themeblvd-modal-close");c.$modal_window.find(".media-button-insert").off("click.themeblvd-modal-indert");c.$modal_window.find(".media-button-delete").off("click.themeblvd-modal-delete");if(c.options.build){c.$modal_window.remove()}else{c.$modal_window.hide()}if(c.secondary){d.removeClass("themeblvd-secondary-modal-on");d.find(".themeblvd-modal-wrap .inline-media-modal-backdrop").remove()}else{d.removeClass("themeblvd-modal-on");d.removeClass("themeblvd-stop-scroll");b("#themeblvd-modal-backdrop").remove()}},close_all:function(){b(".themeblvd-modal-wrap").each(function(){var c=b(this),e,d;if(c.hasClass("build")){e=c.attr("id");d=c.data("target");b("#"+e+"_marker").after(b("#"+d)).remove();c.remove()}else{c.hide()}b("#themeblvd-modal-backdrop").remove();b("body").removeClass("themeblvd-modal-on themeblvd-secondary-modal-on themeblvd-stop-scroll")})},save:function(){var d=this;if(d.options.code_editor){var e=b("#"+d.id+"_editor").data("CodeMirrorInstance"),g=e.getValue(),c;if(d.$elem.is(".tb-block-code-link")){var f=d.$elem.closest(".block").data("field-name");c=d.$elem.closest(".block").find('textarea[name="'+f+'[html]"]')}else{c=d.$elem.closest(".textarea-wrap").find("textarea")}c.val(g)}}};b.fn.ThemeBlvdModal=function(c){return this.each(function(){var d=Object.create(a);d.init(c,this)})};b.fn.ThemeBlvdModal.options={title:"Setup",button:"Save",button_delete:"",button_secondary:"",size:"large",height:"large",build:true,form:false,code_editor:false,code_lang:"html",padding:false,send_back:null,css_class:"",on_load:function(c){},on_display:function(c){},on_cancel:function(c){},on_save:function(c){},on_delete:function(c){},on_secondary:function(c){}}})(jQuery);